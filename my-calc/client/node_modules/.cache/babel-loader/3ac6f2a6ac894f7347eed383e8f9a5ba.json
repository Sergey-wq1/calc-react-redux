{"ast":null,"code":"import { evaluate } from 'mathjs'; // import saveData from '../api/apiSaveData'\n\nimport deleteRequest from '../api/apiDeletehistory';\nimport updateHistory from '../helpers/updateHistory';\nimport { AC, DELETEHISTORY, DEPLY, EVAL, MINUS, MULTIPLY, NUM, PERSENT, PLUS, PLUSMIN, POINT, SHOWRENEWHISTORY } from './actions/variables';\nimport { forbiddenFirstCharacter, forbiddenLastCharacter, replacementSign } from '../helpers/changesOperationsMath';\nconst initialState = {\n  history: [],\n  counter: '0'\n};\n\nconst foundSignIndex = str => {\n  const arr = [];\n\n  for (let i = str.length; i > 0; i -= 1) {\n    if (str[i] === '+' || str[i] === '-' || str[i] === '*' || str[i] === '/') {\n      arr.push(i);\n    }\n  }\n\n  return arr[0];\n};\n\nconst inspectionSigns = state => {\n  const indexSign = foundSignIndex(state.counter);\n  const sliceHistoryStart = state.counter.slice(0, indexSign + 1);\n  const sliceHistoryEnd = state.counter.slice(indexSign + 1, state.counter.length);\n\n  if (indexSign) {\n    if (state.counter[indexSign - 1] === '(') {\n      const sliceStartPlus = sliceHistoryStart.slice(0, indexSign - 1);\n      const sliceEndPlus = sliceHistoryEnd.slice(0, sliceHistoryEnd.length - 1);\n      return { ...state,\n        counter: `${sliceStartPlus}${sliceEndPlus}`\n      };\n    }\n\n    return { ...state,\n      counter: `${sliceHistoryStart}(-${sliceHistoryEnd})`\n    };\n  }\n\n  return { ...state\n  };\n};\n\nconst changeSign = state => {\n  const sign = ['+', '-', '/', '*'];\n  const lengthCounter = state.counter.length;\n\n  if (state.counter[lengthCounter - 1] === '-') {\n    const historyCounterPlusEnd = state.counter.slice(0, lengthCounter - 1);\n    return { ...state,\n      counter: `${historyCounterPlusEnd}+`\n    };\n  }\n\n  if (state.counter[lengthCounter - 1] === '+') {\n    const historyCounter = state.counter.slice(0, lengthCounter - 1);\n    return { ...state,\n      counter: `${historyCounter}-`\n    };\n  }\n\n  if (!state.counter[lengthCounter - 1].includes(sign)) {\n    return inspectionSigns(state);\n  }\n\n  return { ...state\n  };\n};\n\nconst numReducer = (state = initialState, action) => {\n  switch (action.type) {\n    case NUM:\n      {\n        if (state.counter === '0' && state.counter.length === 1) {\n          return { ...state,\n            counter: `${state.counter.slice(1, 2)}${action.number}`\n          };\n        }\n\n        return { ...state,\n          addHistory: [],\n          counter: `${state.counter}${action.number}`\n        };\n      }\n\n    case PLUS:\n      return { ...state,\n        addHistory: [],\n        disabledPoint: false,\n        counter: `${replacementSign(state.counter)}+`\n      };\n\n    case AC:\n      return { ...state,\n        counter: '0'\n      };\n\n    case MULTIPLY:\n      return { ...state,\n        counter: `${replacementSign(state.counter)}*`\n      };\n\n    case MINUS:\n      return { ...state,\n        counter: `${replacementSign(state.counter)}-`\n      };\n\n    case DEPLY:\n      return { ...state,\n        counter: `${replacementSign(state.counter)}/`\n      };\n\n    case POINT:\n      return { ...state,\n        counter: `${replacementSign(state.counter)}.`\n      };\n\n    case PERSENT:\n      {\n        const indexSign = foundSignIndex(state.counter.slice(0, state.counter.length - 1));\n        const startHistory = state.counter.slice(0, indexSign);\n        const percent = state.counter.slice(indexSign + 1, state.counter.length);\n        const resultBeforePercent = evaluate(startHistory.slice(0, startHistory.length - 1));\n        const result = evaluate(resultBeforePercent / 100 * percent);\n        return { ...state,\n          counter: result\n        };\n      }\n\n    case PLUSMIN:\n      return changeSign(state);\n\n    case EVAL:\n      {\n        // saveData(state.counter, forbiddenFirstCharacter(forbiddenLastCharacter(state.counter)))\n        const result = forbiddenFirstCharacter(forbiddenLastCharacter(state.counter));\n        return { ...state,\n          counter: result\n        };\n      }\n\n    case DELETEHISTORY:\n      deleteRequest(action.expression, action.result).then(() => ({ ...state,\n        updateNedeed: state.updateNedeed + 1,\n        history: updateHistory(state.history)\n      })).catch(() => ({ ...state\n      }));\n      return false;\n\n    case SHOWRENEWHISTORY:\n      return { ...state,\n        history: action.history\n      };\n\n    default:\n      return state;\n  }\n};\n\nexport default numReducer;","map":{"version":3,"sources":["D:/github/calc/calc-react-redux/my-calc/client/src/redux/numReducer.js"],"names":["evaluate","deleteRequest","updateHistory","AC","DELETEHISTORY","DEPLY","EVAL","MINUS","MULTIPLY","NUM","PERSENT","PLUS","PLUSMIN","POINT","SHOWRENEWHISTORY","forbiddenFirstCharacter","forbiddenLastCharacter","replacementSign","initialState","history","counter","foundSignIndex","str","arr","i","length","push","inspectionSigns","state","indexSign","sliceHistoryStart","slice","sliceHistoryEnd","sliceStartPlus","sliceEndPlus","changeSign","sign","lengthCounter","historyCounterPlusEnd","historyCounter","includes","numReducer","action","type","number","addHistory","disabledPoint","startHistory","percent","resultBeforePercent","result","expression","then","updateNedeed","catch"],"mappings":"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","sourcesContent":["import { evaluate } from 'mathjs'\r\n// import saveData from '../api/apiSaveData'\r\nimport deleteRequest from '../api/apiDeletehistory'\r\nimport updateHistory from '../helpers/updateHistory'\r\nimport {\r\n  AC,\r\n  DELETEHISTORY,\r\n  DEPLY,\r\n  EVAL,\r\n  MINUS,\r\n  MULTIPLY,\r\n  NUM,\r\n  PERSENT,\r\n  PLUS,\r\n  PLUSMIN,\r\n  POINT,\r\n  SHOWRENEWHISTORY,\r\n} from './actions/variables'\r\nimport { forbiddenFirstCharacter, forbiddenLastCharacter, replacementSign } from '../helpers/changesOperationsMath'\r\n\r\nconst initialState = {\r\n  history: [],\r\n  counter: '0',\r\n}\r\n\r\nconst foundSignIndex = (str) => {\r\n  const arr = []\r\n  for (let i = str.length; i > 0; i -= 1) {\r\n    if (str[i] === '+' || str[i] === '-'\r\n      || str[i] === '*' || str[i] === '/') {\r\n      arr.push(i)\r\n    }\r\n  }\r\n  return arr[0]\r\n}\r\n\r\nconst inspectionSigns = (state) => {\r\n  const indexSign = foundSignIndex(state.counter)\r\n  const sliceHistoryStart = state.counter.slice(0, indexSign + 1)\r\n  const sliceHistoryEnd = state.counter.slice(indexSign + 1, state.counter.length)\r\n  if (indexSign) {\r\n    if (state.counter[indexSign - 1] === '(') {\r\n      const sliceStartPlus = sliceHistoryStart.slice(0, indexSign - 1)\r\n      const sliceEndPlus = sliceHistoryEnd.slice(0, sliceHistoryEnd.length - 1)\r\n      return {\r\n        ...state,\r\n        counter: `${sliceStartPlus}${sliceEndPlus}`,\r\n      }\r\n    }\r\n    return {\r\n      ...state,\r\n      counter: `${sliceHistoryStart}(-${sliceHistoryEnd})`,\r\n    }\r\n  }\r\n  return {\r\n    ...state,\r\n  }\r\n}\r\n\r\nconst changeSign = (state) => {\r\n  const sign = ['+', '-', '/', '*']\r\n  const lengthCounter = state.counter.length\r\n  if (state.counter[lengthCounter - 1] === '-') {\r\n    const historyCounterPlusEnd = state.counter.slice(0, lengthCounter - 1)\r\n    return {\r\n      ...state,\r\n      counter: `${historyCounterPlusEnd}+`,\r\n    }\r\n  } if (state.counter[lengthCounter - 1] === '+') {\r\n    const historyCounter = state.counter.slice(0, lengthCounter - 1)\r\n    return {\r\n      ...state,\r\n      counter: `${historyCounter}-`,\r\n    }\r\n  } if (!state.counter[lengthCounter - 1].includes(sign)) {\r\n    return inspectionSigns(state)\r\n  }\r\n  return {\r\n    ...state,\r\n  }\r\n}\r\n\r\nconst numReducer = (state = initialState, action) => {\r\n  switch (action.type) {\r\n    case NUM: {\r\n      if (state.counter === '0' && state.counter.length === 1) {\r\n        return {\r\n          ...state,\r\n          counter: `${state.counter.slice(1, 2)}${action.number}`,\r\n        }\r\n      }\r\n      return {\r\n        ...state,\r\n        addHistory: [],\r\n        counter: `${state.counter}${action.number}`,\r\n      }\r\n    }\r\n    case PLUS:\r\n      return {\r\n        ...state,\r\n        addHistory: [],\r\n        disabledPoint: false,\r\n        counter: `${replacementSign(state.counter)}+`,\r\n      }\r\n    case AC:\r\n      return {\r\n        ...state,\r\n        counter: '0',\r\n      }\r\n    case MULTIPLY:\r\n      return {\r\n        ...state,\r\n        counter: `${replacementSign(state.counter)}*`,\r\n      }\r\n    case MINUS:\r\n      return {\r\n        ...state,\r\n        counter: `${replacementSign(state.counter)}-`,\r\n      }\r\n    case DEPLY:\r\n      return {\r\n        ...state,\r\n        counter: `${replacementSign(state.counter)}/`,\r\n      }\r\n    case POINT:\r\n      return {\r\n        ...state,\r\n        counter: `${replacementSign(state.counter)}.`,\r\n      }\r\n    case PERSENT: {\r\n      const indexSign = foundSignIndex(state.counter.slice(0, state.counter.length - 1))\r\n      const startHistory = state.counter.slice(0, indexSign)\r\n      const percent = state.counter.slice(indexSign + 1, state.counter.length)\r\n      const resultBeforePercent = evaluate(startHistory.slice(0, startHistory.length - 1))\r\n      const result = evaluate((resultBeforePercent / 100) * percent)\r\n      return {\r\n        ...state,\r\n        counter: result,\r\n      }\r\n    }\r\n    case PLUSMIN:\r\n      return changeSign(state)\r\n    case EVAL: {\r\n      // saveData(state.counter, forbiddenFirstCharacter(forbiddenLastCharacter(state.counter)))\r\n      const result = forbiddenFirstCharacter((forbiddenLastCharacter(state.counter)))\r\n      return {\r\n        ...state,\r\n        counter: result,\r\n      }\r\n    }\r\n    case DELETEHISTORY:\r\n      deleteRequest(action.expression, action.result)\r\n        .then(() => ({\r\n          ...state,\r\n          updateNedeed: state.updateNedeed + 1,\r\n          history: updateHistory(state.history),\r\n        }))\r\n        .catch(() => ({\r\n          ...state,\r\n        }))\r\n      return false\r\n    case SHOWRENEWHISTORY:\r\n      return {\r\n        ...state,\r\n        history: action.history,\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nexport default numReducer\r\n"]},"metadata":{},"sourceType":"module"}